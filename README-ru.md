# **EternalCraft.efmod**

* Это уникальная МОД, которая может запускаться без лаунчера и также может запускаться без основного so. Мы придерживаемся свободы, и во время разработки не требуется использовать какие-либо API.

  ## Android Studio

  * Мы рекомендуем использовать Android Studio для упаковки, потому что если использовать компилятор Android, поддержка не очень хорошая. Использование Android Studio для упаковки позволяет использовать наиболее полную систему, включая две инстанции. Один не сильно отличается от компилятора Android, а другой интегрирует shadowhook, BNM (для краткости). Эта инстанция полностью свободна и может полностью отделиться от основного so. В основном используется для расширения изначально ограниченных функций, с C++20 в качестве минимального стандарта.

  ## AIDE

  * Вам необходимо установить NDK, с C++17 в качестве минимального стандарта. Этот шаблон не обладает сильной расширяемостью, и некоторые части все еще зависят от основного so, например, вызов исходных функций игры.

  # Как создать Мод?

  * Подготовьте инструмент компиляции, используя C++ в качестве стандарта.

    ## 1. Создайте ваш код

    ```C++
    /*
      Это самый простой пример кода.
    */

    extern "C"{
      // Используйте extern "C" обязательно! В противном случае код не будет вызван Major, потому что у функции не будет модификаторов.
      // Предположим, что это код, который нужно вызвать, func1 возвращает целое число типа int значение 114514, func2 возвращает логическое значение типа bool, истинное.
      int func1(){
        return 114514;
      }
      bool func2(){
        return true;
      }
    }
    ```

    ## 2. Создайте конфигурационный JSON мода

    * mod_data

      ```Json
      [
        [
          {
            "author": "Name", // Имя автора
            "modName": "MyMod", // Название мода
            "modIntroduce": "Это мой мод", // Описание мода
            "Opencode": false, // Открытый код или нет
            "OpencodeUrl": null, // URL открытого кода, если таковые имеются
            "build": 1, // Версия
            "enable": false, // Активирован ли мод, должно быть false
            "libname": "libMyMod.so" // Полное имя библиотеки so мода
          },
          [
              {
                "position": "Assembly-CSharp.Cursor.Id", // Функция для перехвата, первое - имя dll, второе - пространство имен (если нет, напрямую указывайте третье), третье - функция/поле
                "function": ["func1"], // Ваша функция, может быть несколько, например ["func1", "func2"]
                "type": "int", // Тип данных
                "arrays": 0 // Значение в возвращаемом массиве, 0 - это первый элемент, 1 - второй и т.д.
              },
              {
                "position": "Assembly-CSharp.Terraria.NPC.GetNPCLocation", 
                "function": ["func2"],
                "type": "bool",
                "arrays": 0
              }
          ]
        ]
      ]
      ```

      ## 3. Создайте каталог мода

      ```txt
      MyMod-Name  Корневой каталог мода, должен соответствовать названию мода + имени автора
      MyMod-Name/resources  Ресурсы мода
      MyMod-Name/icon.png  Иконка мода
      MyMod-Name/libMyMod.so  Библиотека so мода
      MyMod-Name/mod_data.json  Конфигурация мода
      MyMod-Name/mod_info.json  Информация о моде
      ```

    ## 4. Упакуйте мод

    * В основе это файл zip, вы можете запустить скрипт Python или использовать сторонние инструменты для сжатия, после чего добавьте суффикс efmod.
    * Для запуска скрипта Python убедитесь, что установлена библиотека zipfile
      > pip install zipfile
    * Передайте каталог мода следующим образом:
      > /home/eternalfuture/Documents/GitHub/Terraria-ToolBox/MyMod-Name
